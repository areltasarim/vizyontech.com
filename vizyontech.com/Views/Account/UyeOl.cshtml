@model BayiOlViewModel
@inject HelperServis _helperServis
@{
    var siteAyariHelper = await _helperServis.GetSiteAyari();
    var siteAyari = siteAyariHelper?.SiteAyarlari;

    ViewBag.MetaTitle = "Bayi Ol";
    ViewBag.MetaAnahtar = siteAyariHelper?.MetaAnahtar ?? "";
    ViewBag.MetaAciklama = siteAyariHelper?.MetaAciklama ?? "";
}
@section Style
{

}

<div class="ps-account">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <form method="post" enctype="multipart/form-data" id="frmUyeOl">
                    <partial name="_BilgiMesaji" />
                    <input type="hidden" asp-for="Captcha" />

                    <div class="ps-form--review">
                        <h2 class="ps-form__title">@Localize("Genel.BayiOl")</h2>
                        <div class="ps-form__group">
                            <label class="ps-form__label">@Localize("Genel.FirmaAdi") *</label>
                            <input class="form-control ps-form__input" type="text" asp-for="FirmaAdi">
                            <span asp-validation-for="FirmaAdi" class="text-danger"></span>
                        </div>
                        <div class="ps-form__group">
                            <label class="ps-form__label">@Localize("Genel.YetkiliAdSoyad") *</label>
                            <input class="form-control ps-form__input" type="text" asp-for="Ad">
                            <span asp-validation-for="Ad" class="text-danger"></span>
                        </div>
                        <div class="ps-form__group">
                            <label class="ps-form__label">@Localize("Genel.il") *</label>
                            <select class="form-control adres_il" asp-for="IlId" data-ilce="AdresEkle_IlceId" asp-items="@ViewData["Iller"] as IEnumerable<SelectListItem>">
                                <option value="">Seçiniz</option>
                            </select>
                            <span asp-validation-for="IlId" class="text-danger"></span>
                        </div>
                        <div class="ps-form__group">
                            <label class="ps-form__label">@Localize("Genel.ilce") *</label>
                            <select class="form-control" asp-for="AdresEkle.IlceId" readonly asp-items="@ViewData["Ilceler"] as IEnumerable<SelectListItem>">
                                <option value="">@Localize("Genel.Seciniz")</option>
                            </select>
                            <span asp-validation-for="AdresEkle.IlceId" class="text-danger"></span>
                        </div>
                        <div class="ps-form__group">
                            <label class="ps-form__label">@Localize("Genel.Adres") *</label>
                            <textarea asp-for="Adres" class="form-control"></textarea>
                            <span asp-validation-for="Adres" class="text-danger"></span>
                        </div>
                        <div class="ps-form__group">
                            <label class="ps-form__label">@Localize("Genel.FirmaAdresi") *</label>
                            <input class="form-control ps-form__input" type="text" asp-for="Adres">
                            <span asp-validation-for="Adres" class="text-danger"></span>
                        </div>
                        <div class="ps-form__group">
                            <label class="ps-form__label">@Localize("Genel.VergiDairesi") *</label>
                            <input class="form-control ps-form__input" type="text" asp-for="VergiDairesi">
                            <span asp-validation-for="VergiDairesi" class="text-danger"></span>
                        </div>
                        <div class="ps-form__group">
                            <label class="ps-form__label">@Localize("Genel.VergiNo") *</label>
                            <input class="form-control ps-form__input" type="text" asp-for="VergiNumarasi">
                            <span asp-validation-for="VergiNumarasi" class="text-danger"></span>
                        </div>
                        @*<div class="ps-form__group">
                                <label asp-for="VergiLevhasiDosya">@Localize("Genel.VergiLevhasi") *</label>
                                <input type="file" class="form-control-file" style="padding-bottom:4rem;" asp-for="VergiLevhasiDosya" required>
                                <span asp-validation-for="VergiNumarasi" class="text-danger"></span>
                            </div>*@
                        <div class="ps-form__group">
                            <label class="ps-form__label">@Localize("Genel.Gsm") *</label>
                            <input class="form-control ps-form__input" type="text" asp-for="Gsm">
                            <span asp-validation-for="Gsm" class="text-danger"></span>
                        </div>
                        <div class="ps-form__group">
                            <label class="ps-form__label">@Localize("Genel.Email") *</label>
                            <input class="form-control ps-form__input" type="email" asp-for="Email">
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>
                        <div class="ps-form__group">
                            <label class="ps-form__label">@Localize("Genel.Password") *</label>
                            <input class="form-control ps-form__input" type="password" asp-for="Password">
                            <span asp-validation-for="Password" class="text-danger"></span>
                        </div>
                        <div class="ps-form__submit">
                            <button class="ps-btn ps-btn--warning" type="submit">@Localize("Genel.KayitOl")</button>
                        </div>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>


@section Scripts
{
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/js/site.js"></script>
    <partial name="_ValidationScriptsPartial" />

    <script src="https://www.google.com/recaptcha/api.js?render=@Configuration["googleReCaptcha:SiteKey"]"></script>
    <script>
    let captchaReady = false;

    $(document).ready(function () {
        $('#frmUyeOl').on('submit', function (e) {

            // Eğer token daha alınmadıysa engelle ve önce al
            if (!captchaReady) {
                e.preventDefault();

                grecaptcha.ready(function () {
                    grecaptcha.execute('@Configuration["googleReCaptcha:SiteKey"]', { action: 'home' }).then(function (token) {
                        $('#Captcha').val(token);
                        captchaReady = true;
                        $('#frmUyeOl').submit(); // Bu kez captchaReady true olduğu için validation çalışır
                    });
                });
            } else {
                // Submit işlemi bu sefer normal şekilde devam eder (validation çalışır)
                captchaReady = false; // Form tekrar gönderilirse reCAPTCHA yeniden alınmalı
            }
        });
    });
    </script>

}

